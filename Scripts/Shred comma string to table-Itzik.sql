USE tempdb
GO

checkpoint
dbcc dropcleanbuffers
dbcc freeproccache
GO

--declare a variable and populate it with a comma separated string
DECLARE @SQLString VARCHAR(MAX)
SET @SQLString = '111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999,111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999111,211,311,411,5,6,7,811,911,1199,2299,3399,4499,5599,699,799,899,999';

--append a comma to the string to get correct results with empty strings or strings with a single value (no commas)
SET @SQLString = @SQLString + ',';


--the main query
--Itzik Ban-Gan style CTE to generate us a lot of numbers (this will produce up to 65536)
WITH Nbrs_3(n) AS (SELECT 1 UNION SELECT 0),
	Nbrs_2(n) AS (SELECT 1 FROM Nbrs_3 n1 CROSS JOIN Nbrs_3 n2),
	Nbrs_1(n) AS (SELECT 1 FROM Nbrs_2 n1 CROSS JOIN Nbrs_2 n2),
	Nbrs_0(n) AS (SELECT 1 FROM Nbrs_1 n1 CROSS JOIN Nbrs_1 n2),
	Nbrs  (n) AS (SELECT 1 FROM Nbrs_0 n1 CROSS JOIN Nbrs_0 n2)
--chop up the string based on the position of the comma returned from the inner query
SELECT SUBSTRING(@SQLString, n+1, CHARINDEX(',', @SQLString, n+1) - n-1)
FROM
(
	--select a holding record to ensure we get the very first value in the string
	SELECT 0 AS 'n' 
	UNION ALL 
	--select the maximum amount of generated numbers that we will need.
	--this will be the len of the string -1. the last char of string is a comma
	SELECT TOP(LEN(@SQLString)-1) ROW_NUMBER() OVER (ORDER BY n) AS 'n'
    FROM Nbrs
) x
--only return the numbers that equate to the position of a comma in the original string
--returning 0 ensures that we get the first value in the string.
WHERE SUBSTRING(@SQLString, n, 1) = ',' OR n = 0